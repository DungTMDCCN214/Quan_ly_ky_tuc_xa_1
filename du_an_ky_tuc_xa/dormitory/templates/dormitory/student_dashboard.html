{% extends 'base.html' %}

{% block title %}Dashboard Sinh Vi√™n{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h2>üéì Dashboard Sinh Vi√™n</h2>
            
            <!-- Th√¥ng b√°o -->
            {% if messages %}
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            {% endif %}

            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Xin ch√†o, {{ user.username }}!</h5>
                    
                    <!-- Th√¥ng tin sinh vi√™n -->
                    {% if student %}
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <p><strong>M√£ SV:</strong> {{ student.student_id }}</p>
                            <p><strong>Tr∆∞·ªùng:</strong> {{ student.university }}</p>
                            <p><strong>Khoa:</strong> {{ student.faculty }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Kh√≥a:</strong> {{ student.course }}</p>
                            <p><strong>H·ªç t√™n:</strong> {{ student.full_name|default:user.get_full_name }}</p>
                            <p><strong>Email:</strong> {{ user.email }}</p>
                        </div>
                    </div>
                    {% endif %}

                    <!-- H·ª£p ƒë·ªìng hi·ªán t·∫°i -->
                    {% if current_contract %}
                    <div class="alert alert-success">
                        <h6>‚úÖ H·ª¢P ƒê·ªíNG HI·ªÜN T·∫†I</h6>
                        <p><strong>Ph√≤ng:</strong> {{ current_contract.room.room_number }} - {{ current_contract.room.building.name }}</p>
                        <p><strong>Ng√†y b·∫Øt ƒë·∫ßu:</strong> {{ current_contract.start_date }}</p>
                        <p><strong>Ng√†y k·∫øt th√∫c:</strong> {{ current_contract.end_date }}</p>
                        <p><strong>Tr·∫°ng th√°i:</strong> 
                            <span class="badge bg-success">{{ current_contract.get_status_display }}</span>
                        </p>
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        <h6>‚ö†Ô∏è CH∆ØA C√ì H·ª¢P ƒê·ªíNG</h6>
                        <p>B·∫°n ch∆∞a c√≥ h·ª£p ƒë·ªìng ph√≤ng n√†o. H√£y ƒëƒÉng k√Ω ph√≤ng ngay!</p>
                    </div>
                    {% endif %}

                    <!-- Menu ch·ª©c nƒÉng -->
                    <div class="row mt-4">
                        <div class="col-md-3">
                            <div class="card text-white bg-primary mb-3">
                                <div class="card-body text-center">
                                    <h5 class="card-title">üè† Ph√≤ng Tr·ªëng</h5>
                                    <p class="card-text">ƒêƒÉng k√Ω ph√≤ng m·ªõi</p>
                                    <a href="#available-rooms" class="btn btn-light btn-sm">Xem ngay</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-white bg-success mb-3">
                                <div class="card-body text-center">
                                    <h5 class="card-title">üìÑ H·ª£p ƒë·ªìng</h5>
                                    <p class="card-text">Th√¥ng tin h·ª£p ƒë·ªìng</p>
                                    <a href="#" class="btn btn-light btn-sm">Chi ti·∫øt</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-white bg-info mb-3">
                                <div class="card-body text-center">
                                    <h5 class="card-title">üí∞ Thanh to√°n</h5>
                                    <p class="card-text">L·ªãch s·ª≠ thanh to√°n</p>
                                    <a href="#" class="btn btn-light btn-sm">Xem l·ªãch s·ª≠</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-white bg-warning mb-3">
                                <div class="card-body text-center">
                                    <h5 class="card-title">üë§ H·ªì s∆°</h5>
                                    <p class="card-text">C·∫≠p nh·∫≠t th√¥ng tin</p>
                                    <a href="#" class="btn btn-light btn-sm">Ch·ªânh s·ª≠a</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Danh s√°ch ph√≤ng tr·ªëng -->
                    <div id="available-rooms" class="mt-5">
                        <h4>üè† Ph√≤ng Tr·ªëng Hi·ªán C√≥</h4>
                        {% if available_rooms %}
                        <div class="row">
                            {% for room in available_rooms %}
                            <div class="col-md-4 mb-3">
                                <div class="card">
                                    <div class="card-body">
                                        <h6 class="card-title">Ph√≤ng {{ room.room_number }}</h6>
                                        <p class="card-text small">
                                            <strong>T√≤a:</strong> {{ room.building.name }}<br>
                                            <strong>Lo·∫°i:</strong> {{ room.room_type.name }}<br>
                                            <strong>S·ª©c ch·ª©a:</strong> {{ room.room_type.capacity }} ng∆∞·ªùi<br>
                                            <strong>Gi√°:</strong> {{ room.room_type.price_per_month|floatformat:0 }} VNƒê<br>
                                            <strong>T·∫ßng:</strong> {{ room.floor }}
                                        </p>
                                        {% if not current_contract %}
                                        <a href="{% url 'room_booking' room.id %}" class="btn btn-primary btn-sm">ƒêƒÉng k√Ω ngay</a>
                                        {% else %}
                                        <button class="btn btn-secondary btn-sm" disabled>ƒê√£ c√≥ ph√≤ng</button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="alert alert-info">
                            Hi·ªán kh√¥ng c√≥ ph√≤ng tr·ªëng n√†o.
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}