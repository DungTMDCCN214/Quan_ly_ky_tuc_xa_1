<!-- dormitory/templates/dormitory/reports.html -->
{% extends 'base.html' %}

{% block title %}B√°o c√°o & Th·ªëng k√™{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>üìä B√°o c√°o & Th·ªëng k√™</h1>
    <div>
        <div class="btn-group">
            <a href="{% url 'export_rooms_excel' %}" class="btn btn-outline-success">üìä Xu·∫•t Excel</a>
            <a href="{% url 'export_rooms_pdf' %}" class="btn btn-outline-danger">üìÑ Xu·∫•t PDF</a>
        </div>
        <button class="btn btn-success ms-2" onclick="window.print()">üñ®Ô∏è In b√°o c√°o</button>
        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary ms-2">üìä Dashboard</a>
    </div>
</div>
<!-- TH·ªêNG K√ä T·ªîNG QUAN -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                            T·ªïng ph√≤ng
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ room_stats.total }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-door-closed fa-2x text-gray-300">üö™</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            Ph√≤ng tr·ªëng
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ room_stats.available }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-bed fa-2x text-gray-300">‚úÖ</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                            T·ª∑ l·ªá l·∫•p ƒë·∫ßy
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ room_stats.occupancy_percentage|floatformat:1 }}%
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-chart-pie fa-2x text-gray-300">üìà</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            Hƒê s·∫Øp h·∫øt h·∫°n
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ contract_stats.upcoming_expiry }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-clock fa-2x text-gray-300">‚è∞</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- BI·ªÇU ƒê·ªí PH√ÇN B·ªê PH√íNG -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5>üìä Ph√¢n b·ªë tr·∫°ng th√°i ph√≤ng</h5>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <div class="row">
                        <div class="col-4">
                            <div class="text-success">
                                <h3>{{ room_stats.available }}</h3>
                                <small>‚úÖ C√≤n tr·ªëng</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="text-danger">
                                <h3>{{ room_stats.occupied }}</h3>
                                <small>‚õî ƒê√£ thu√™</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="text-warning">
                                <h3>{{ room_stats.maintenance }}</h3>
                                <small>üõ†Ô∏è B·∫£o tr√¨</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5>üìà Th·ªëng k√™ h·ª£p ƒë·ªìng</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-4">
                        <div class="text-success">
                            <h3>{{ contract_stats.active }}</h3>
                            <small>‚úÖ ƒêang ho·∫°t ƒë·ªông</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-danger">
                            <h3>{{ contract_stats.expired }}</h3>
                            <small>‚ùå ƒê√£ h·∫øt h·∫°n</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-warning">
                            <h3>{{ contract_stats.upcoming_expiry }}</h3>
                            <small>‚è∞ S·∫Øp h·∫øt h·∫°n</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- TH·ªêNG K√ä THEO T√íA NH√Ä -->
<div class="card mt-4">
    <div class="card-header bg-info text-white">
        <h5>üè¢ Th·ªëng k√™ theo t√≤a nh√†</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>T√≤a nh√†</th>
                        <th>T·ªïng ph√≤ng</th>
                        <th>Ph√≤ng ƒë√£ thu√™</th>
                        <th>T·ª∑ l·ªá l·∫•p ƒë·∫ßy</th>
                        <th>Ph√≤ng tr·ªëng</th>
                    </tr>
                </thead>
                <tbody>
                    {% for building in building_stats %}
                    <tr>
                        <td><strong>{{ building.name }}</strong></td>
                        <td>{{ building.total_rooms }}</td>
                        <td>{{ building.occupied_rooms }}</td>
                        <td>
                            {% if building.total_rooms > 0 %}
                                <span class="badge bg-{% if building.occupancy_rate >= 80 %}danger{% else %}success{% endif %}">
                                    {{ building.occupancy_rate|floatformat:1 }}%
                                </span>
                            {% else %}
                                <span class="badge bg-secondary">0%</span>
                            {% endif %}
                        </td>
                        <td>{{ building.available_rooms }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- B√ÅO C√ÅO DOANH THU (Placeholder) -->
<div class="card mt-4">
    <div class="card-header bg-warning text-dark">
        <h5>üí∞ B√°o c√°o doanh thu (Coming Soon)</h5>
    </div>
    <div class="card-body">
        <p class="text-muted">T√≠nh nƒÉng b√°o c√°o doanh thu s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t trong phi√™n b·∫£n ti·∫øp theo.</p>
        <ul>
            <li>üìÖ Doanh thu theo th√°ng/qu√Ω/nƒÉm</li>
            <li>üìä Bi·ªÉu ƒë·ªì tƒÉng tr∆∞·ªüng doanh thu</li>
            <li>üìà Ph√¢n t√≠ch xu h∆∞·ªõng</li>
            <li>üìã B√°o c√°o chi ti·∫øt</li>
        </ul>
    </div>
</div>
{% endblock %}